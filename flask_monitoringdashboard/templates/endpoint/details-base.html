{% extends "dashboard/dashboard-base.html" %}

{% block subcontent %}

{% set url_heatmap='dashboard.result_heatmap' %}
{% set url_time_hour='dashboard.result_time_per_hour' %}
{% set url_hits_hour='dashboard.result_hits_per_hour' %}
{% set url_version_user='dashboard.result_time_per_version_per_user' %}
{% set url_version_ip='dashboard.result_time_per_version_per_ip' %}
{% set url_version='dashboard.result_time_per_version' %}
{% set url_user='dashboard.result_time_per_user' %}
{% set url_outliers='dashboard.result_outliers' %}

<div class="card mb-3">
  <div class="card-header"><h4>Summary of endpoint</h4></div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-hover">
        <tr>
          <td><b>Endpoint</b></td>
          <td>{{ details.endpoint }}</td>
        </tr>
        <tr>
          <td><b>Added since app version</b></td>
          <td>{{ details.rule.version_added }}</td>
        </tr>
        <tr>
          <td><b>Date added to app</b></td>
          <td>{{ "{:%Y-%m-%d %H:%M:%S }".format(details.rule.time_added) }}</td>
        </tr>
        {% if url %}
          <tr>
            <td><b>Link to endpoint</b></td>
            <td><a href="{{ details.url }}">{{ details.url }}</a></td>
          </tr>
        {% endif %}
        <tr>
          <td><b>Last accessed</b></td>
          <td>{{ "{:%Y-%m-%d %H:%M:%S }".format(details.rule.last_accessed) }}</td>
        </tr>
      </table>
    </div>
  </div>
</div>

<div class="card mb-3">

    {% macro menubar_item(endpoint, name) %}
    <li class="nav-item">
      <a class="nav-link {{ active_if_is(endpoint) }}" href="{{ url_for(endpoint, end=details.endpoint) }}">
        <span class="nav-link-text">{{ name }}</span>
      </a>
    </li>
    {%- endmacro %}

    <div class="card-header">
      <nav class="navbar navbar-expand-sm">
        <div class="collapse navbar-collapse" id="nav-content">
          <ul class="navbar-nav nav-pills">
            {{ menubar_item(url_heatmap, 'Heatmap') }}
            {{ menubar_item(url_time_hour, 'Time per hour') }}
            {{ menubar_item(url_hits_hour, 'Hits per hour') }}
            {{ menubar_item(url_version_user, 'Time per version per user') }}
            {{ menubar_item(url_version_ip, 'Time per version per ip') }}
            {{ menubar_item(url_version, 'Time per version') }}
            {{ menubar_item(url_user, 'Time per user') }}
            {{ menubar_item(url_outliers, 'Outliers') }}
          </ul>
        </div>
      </nav>
    </div>
  <div class="card-body">

    <div id="loading">
      <div class="col-md-12 col-sm-12">
        <br>
        <div class="text-center">
          <img src="{{ url_for('dashboard.static', filename='loading.gif') }}"
               alt="Be patient..." align="center"/>
        </div>
      </div>
    </div>

    {% block graph_content %}
    {% endblock %}

  </div>
</div>
{% endblock %}

{% block script %}
<script>
  $(window).ready(function () {
    $('#loading').hide();
  });
</script>
{% endblock %}